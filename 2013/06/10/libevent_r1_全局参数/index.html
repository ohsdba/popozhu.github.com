<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    

    <title>Libevent全局参数 | popozhu</title>

    

    <!-- css -->
    <link href="http://fonts.useso.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css">

    </head>

    <body>
	<div class="container">
	    <div class="banner">
    <div>
        <span class="site-title"> <a href="/" id="logo">popozhu</a> </span>

        
    </div>

    <div class="banner-right">
        <span class="banner-item"> <a href="/archives"> Misc </a> </span>
        <span class="banner-item"> <a href="/about"> About </a> </span>
    </div>
</div>


	    <section id="main"><article class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
	<header class="article-header">
	    <div class="article-title">
		<div class="title">Libevent全局参数</div> 
		<small>
		    <time datetime="2013-06-10T13:27:39.000Z" itemprop="datePublished">June 10 2013</time>
		</small>
	    </div>
	</header>
    

    <div class="article-entry" itemprop="articleBody">
	
	    
	    
		<div class="article-toc"> Toc <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#打印日志"><span class="toc-text">打印日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#examples"><span class="toc-text">Examples</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#handling-fatal-errors-出错处理"><span class="toc-text">Handling fatal errors 出错处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内存管理"><span class="toc-text">内存管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#example"><span class="toc-text">Example</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#locks-and-threading-锁和线程"><span class="toc-text">Locks and threading 锁和线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#examples"><span class="toc-text">Examples</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debugging-lock-usage-调试锁"><span class="toc-text">Debugging lock usage 调试锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调试event"><span class="toc-text">调试event</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#example"><span class="toc-text">Example</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检测libevent的版本"><span class="toc-text">检测Libevent的版本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#example-compile-time-checks"><span class="toc-text">Example: Compile-time checks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#example-run-time-checks"><span class="toc-text">Example: Run-time checks</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#释放全局数据结构"><span class="toc-text">释放全局数据结构</span></a></li></ol> </div>
	    

	    <blockquote>
<p>&#x539F;&#x6587;&#xFF1A;<a href="http://www.wangafu.net/~nickm/libevent-book/Ref1_libsetup.html" target="_blank" rel="external">R1: Setting up the Libevent library</a></p>
</blockquote>
<p>Libevent&#x6709;&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x53C2;&#x6570;&#xFF0C;&#x8BBE;&#x7F6E;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x5F71;&#x54CD;&#x6574;&#x4E2A;&#x5E93;&#xFF0C;&#x8FDB;&#x800C;&#x5F71;&#x54CD;&#x5230;&#x6574;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x82E5;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5728;&#x4F7F;&#x7528;Libevent&#x4E4B;&#x524D;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#xFF0C;&#x5426;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x53C2;&#x6570;&#x524D;&#x540E;&#x4E0D;&#x4E00;&#x81F4;&#x800C;&#x5BFC;&#x81F4;&#x6302;&#x8D77;&#x3002;  </p>
<h2 id="&#x6253;&#x5370;&#x65E5;&#x5FD7;"><a href="#&#x6253;&#x5370;&#x65E5;&#x5FD7;" class="headerlink" title="&#x6253;&#x5370;&#x65E5;&#x5FD7;"></a>&#x6253;&#x5370;&#x65E5;&#x5FD7;</h2><p>Libevent&#x80FD;&#x8BB0;&#x5F55;&#x9519;&#x8BEF;&#x548C;&#x8B66;&#x544A;&#x6D88;&#x606F;&#x3002;&#x5982;&#x679C;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x52A0;&#x5165;debug&#x5F00;&#x5173;&#xFF0C;&#x90A3;&#x4E5F;&#x80FD;&#x8BB0;&#x5F55;&#x5B83;&#x81EA;&#x8EAB;&#x8FD0;&#x884C;&#x7684;debug&#x65E5;&#x5FD7;&#x3002;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x9ED8;&#x8BA4;&#x5199;&#x5230;stderr&#xFF0C;&#x4F46;&#x4F60;&#x80FD;&#x4FEE;&#x6539;&#x5B83;&#xFF0C;&#x4F7F;&#x7528;&#x4F60;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x51FD;&#x6570;&#x3002;  </p>
<pre><code>#define EVENT_LOG_DEBUG 0
#define EVENT_LOG_MSG   1
#define EVENT_LOG_WARN  2
#define EVENT_LOG_ERR   3

/* Deprecated; see note at the end of this section */
#define _EVENT_LOG_DEBUG EVENT_LOG_DEBUG
#define _EVENT_LOG_MSG   EVENT_LOG_MSG
#define _EVENT_LOG_WARN  EVENT_LOG_WARN
#define _EVENT_LOG_ERR   EVENT_LOG_ERR

typedef void (*event_log_cb)(int severity, const char *msg);

void event_set_log_callback(event_log_cb cb);
</code></pre><p>&#x4F7F;&#x7528;<code>event_log_cb</code>&#x5B9A;&#x4E49;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x51FD;&#x6570;&#xFF0C; &#x7136;&#x540E;&#x8BBE;&#x7F6E;&#xFF08;&#x4EE5;&#x8986;&#x76D6;&#x7684;&#x65B9;&#x5F0F;&#xFF09;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;<code>event_set_log_callback()</code>. &#x5F53;Libevent&#x6253;&#x5370;&#x65E5;&#x5FD7;&#x65F6;&#xFF0C;&#x65E5;&#x5FD7;&#x5185;&#x5BB9;&#x5C31;&#x4F20;&#x5230;&#x4F60;&#x5B9A;&#x4E49;&#x7684;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x51FD;&#x6570;&#x3002;<br>&#x82E5;&#x8981;&#x6062;&#x590D;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF0C; &#x518D;&#x8C03;&#x7528;&#x4E00;&#x6B21;<code>event_set_log_callback()</code>&#xFF0C; &#x4F20;&#x4E00;&#x4E2A;NULL&#x53C2;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;  </p>
<h4 id="examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><pre><code>#include &lt;event2/event.h&gt;
#include &lt;stdio.h&gt;

static void discard_cb(int severity, const char *msg)
{
    /* This callback does nothing. */
}

static FILE *logfile = NULL;
static void write_to_file_cb(int severity, const char *msg)
{
    const char *s;
    if (!logfile)
        return;
    switch (severity) {
        case _EVENT_LOG_DEBUG: s = &quot;debug&quot;; break;
        case _EVENT_LOG_MSG:   s = &quot;msg&quot;;   break;
        case _EVENT_LOG_WARN:  s = &quot;warn&quot;;  break;
        case _EVENT_LOG_ERR:   s = &quot;error&quot;; break;
        default:               s = &quot;?&quot;;     break; /* never reached */
    }
    fprintf(logfile, &quot;[%s] %s\n&quot;, s, msg);
}

/* Turn off all logging from Libevent. */
void suppress_logging(void)
{
    event_set_log_callback(discard_cb);
}

/* Redirect all Libevent log messages to the C stdio file &apos;f&apos;. */
void set_logfile(FILE *f)
{
    logfile = f;
    event_set_log_callback(write_to_file_cb);
}
</code></pre><p><strong> &#x6CE8;&#x610F; </strong><br>&#x5728;&#x4F60;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x51FD;&#x6570;&#x91CC;&#x518D;&#x8C03;&#x7528;Libevent&#x7684;&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x3002;<br>&#x6BD4;&#x5982;&#x5728;&#x4F60;&#x7684;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x51FD;&#x6570;&#x91CC;&#x8BD5;&#x56FE;&#x4F7F;&#x7528;bufferevents&#x7ED9;sock&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#xFF0C;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x96BE;&#x4EE5;&#x5B9A;&#x4F4D;&#x7684;bug&#x3002;<br>&#x5728;&#x672A;&#x6765;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x4E00;&#x4E9B;Libevent&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x5C31;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x3002;  </p>
<p>Libevent&#x81EA;&#x8EAB;&#x7684;debug&#x65E5;&#x5FD7;&#x529F;&#x80FD;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x3002;&#x5982;&#x679C;Libevent&#x652F;&#x6301;&#x81EA;&#x8EAB;debug&#x65E5;&#x5FD7;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x6253;&#x5F00;&#x3002;  </p>
<pre><code>#define EVENT_DBG_NONE 0
#define EVENT_DBG_ALL 0xffffffffu

void event_enable_debug_logging(ev_uint32_t which);
</code></pre><p>Libevent&#x7684;debug&#x65E5;&#x5FD7;&#x5F88;&#x591A;&#xFF0C;&#x800C;&#x4E14;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x6CA1;&#x4EC0;&#x4E48;&#x7528;&#x5904;&#xFF0C; &#x8C03;&#x7528;<code>event_enable_debug_logging()</code>&#xFF0C; &#x4F7F;&#x7528;&#x53C2;&#x6570;<code>EVENT_DBG_NONE</code>&#x6765;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#xFF0C; &#x4F7F;&#x7528;&#x53C2;&#x6570;<code>EVENT_DBG_ALL</code>&#x5219;&#x6253;&#x5F00;&#x6240;&#x6709;&#x652F;&#x6301;&#x7684;debug&#x65E5;&#x5FD7;&#x3002; &#x672A;&#x6765;&#x7248;&#x672C;&#x53EF;&#x80FD;&#x652F;&#x6301;&#x66F4;&#x591A;&#x53C2;&#x6570;&#x3002;  </p>
<p>&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x5728;&#x5934;&#x6587;&#x4EF6;<code>&lt;event2/event.h&gt;</code>&#x3002; &#x9664;&#x4E86;<code>event_enable_debug_logging()</code>&#x662F;&#x5728;2.1.1-alpha&#x7248;&#x672C;&#x4E2D;&#x624D;&#x51FA;&#x73B0;&#xFF0C;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x5728;&#x7248;&#x672C;1.0c&#x4E2D;&#x9996;&#x6B21;&#x51FA;&#x73B0;&#x3002;  </p>
<p><strong> &#x517C;&#x5BB9;&#x5907;&#x5FD8; </strong><br>&#x5728;Libevent 2.0.19-stable&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x4E4B;&#x524D;&#xFF0C;&#x4EE5;<code>EVENT_LOG_</code>&#x4E3A;&#x524D;&#x7F00;&#x7684;&#x8FD9;&#x4E00;&#x7C7B;&#x5B8F;&#x662F;&#x8FD9;&#x6837;&#x547D;&#x540D;&#x7684;&#xFF1A;<br>_EVENT_LOG_DEBUG<br>_EVENT_LOG_MSG<br>_EVENT_LOG_WARN<br>_EVENT_LOG_ERR<br>&#x9664;&#x975E;&#x517C;&#x5BB9;&#x8001;&#x7248;&#x672C;Libevent 2.0.18-stable&#x6216;&#x66F4;&#x65E9;&#x7684;&#x65E7;&#x7248;&#x672C;&#xFF0C;&#x4E0D;&#x5E94;&#x518D;&#x4F7F;&#x7528;&#x8FD9;&#x4E00;&#x7C7B;&#x5B8F;&#x4E86;&#x3002; &#x672A;&#x6765;&#x7248;&#x672C;&#x4E2D;&#x5C06;&#x79FB;&#x9664;&#x8FD9;&#x4E9B;&#x5B8F;&#x3002;  </p>
<p><br></p>
<h2 id="handling-fatal-errors-&#x51FA;&#x9519;&#x5904;&#x7406;"><a href="#Handling-fatal-errors-&#x51FA;&#x9519;&#x5904;&#x7406;" class="headerlink" title="Handling fatal errors &#x51FA;&#x9519;&#x5904;&#x7406;"></a>Handling fatal errors &#x51FA;&#x9519;&#x5904;&#x7406;</h2><p>&#x5F53;Libevent&#x76D1;&#x6D4B;&#x5230;&#x4E0D;&#x53EF;&#x6062;&#x590D;&#x7684;&#x5185;&#x90E8;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x6BC1;&#x574F;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x8C03;&#x7528;<code>exit()</code>&#x6216;&#x8005;<code>abort()</code>&#x9000;&#x51FA;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x3002; &#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x4E00;&#x822C;&#x8BF4;&#x660E;&#x67D0;&#x5904;&#x4EE3;&#x7801;&#x6709;bug&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x5728;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x91CC;&#xFF0C;&#x8981;&#x4E48;&#x5728;Libevent&#x81EA;&#x8EAB;&#x4EE3;&#x7801;&#x91CC;&#x3002;  </p>
<p>Libevent&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8BA9;&#x4F60;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4F60;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x6765;&#x66F4;&#x4E3A;&#x4F18;&#x96C5;&#x5730;&#x5904;&#x7406;&#x8FD9;&#x7C7B;&#x9519;&#x8BEF;&#x3002;  </p>
<pre><code>typedef void (*event_fatal_cb)(int err);
void event_set_fatal_callback(event_fatal_cb cb);
</code></pre><p>&#x4F7F;&#x7528;&#x4E0A;&#xFF0C;&#x4F60;&#x5148;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x518D;&#x8C03;&#x7528;<code>event_set_fatal_callback()</code>&#x8BBE;&#x7F6E;&#x4F60;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;&#x540E;&#x7EED;&#x9047;&#x5230;&#x8FD9;&#x7C7B;&#x81F4;&#x547D;&#x7684;&#x9519;&#x8BEF;&#xFF0C;Libevent&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x4F60;&#x7684;&#x51FD;&#x6570;&#x3002;  </p>
<p>&#x4F60;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x91CC;&#x4E0D;&#x5E94;&#x518D;&#x8FD4;&#x56DE;&#x5230;Libevent&#x91CC;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x4F1A;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x9884;&#x8BA1;&#x7684;&#x9519;&#x8BEF;&#xFF0C;Libevent&#x4E5F;&#x53EF;&#x80FD;&#x5728;&#x540E;&#x7EED;&#x9000;&#x51FA;&#x6216;&#x5D29;&#x6E83;&#x3002; &#x4E00;&#x65E6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4F60;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x518D;&#x8C03;&#x7528;&#x5176;&#x4ED6;Libevent&#x51FD;&#x6570;&#x3002;  </p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x9996;&#x6B21;&#x51FA;&#x73B0;&#x5728;Libevent 2.0.3-alpha&#xFF0C;&#x5B9A;&#x4E49;&#x5728;<code>&lt;event2/event.h&gt;</code>&#x3002; </p>
<p><br></p>
<h2 id="&#x5185;&#x5B58;&#x7BA1;&#x7406;"><a href="#&#x5185;&#x5B58;&#x7BA1;&#x7406;" class="headerlink" title="&#x5185;&#x5B58;&#x7BA1;&#x7406;"></a>&#x5185;&#x5B58;&#x7BA1;&#x7406;</h2><p>Libevent&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;C&#x5E93;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x4ECE;&#x5806;&#x4E0A;&#x5206;&#x914D;&#x5185;&#x5B58;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6709;&#x66F4;&#x9AD8;&#x6548;&#x7387;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x8005;&#x4E3A;&#x4E86;&#x68C0;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4F7F;&#x7528;&#x4F60;&#x7684;&#x51FD;&#x6570;&#x6765;&#x66FF;&#x4EE3;malloc, realloc, free&#x3002;  </p>
<pre><code>void event_set_mem_functions(
    void *(*malloc_fn)(size_t sz), 
    void *(*realloc_fn)(void *ptr, size_t sz), 
    void (*free_fn)(void *ptr));
</code></pre><p>&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x66FF;&#x6362;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x91CC;&#x7EDF;&#x8BA1;&#x603B;&#x5171;&#x7533;&#x8BF7;&#x4E86;&#x591A;&#x5C11;&#x5B57;&#x8282;&#x5185;&#x5B58;&#x3002; &#x5982;&#x679C;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x91CC;&#x4F7F;&#x7528;Libevent&#xFF0C;&#x90A3;&#x5B9E;&#x9645;&#x4E0A;&#x4F60;&#x53EF;&#x80FD;&#x60F3;&#x5728;&#x8FD9;&#x91CC;&#x52A0;&#x4E00;&#x4E2A;&#x9501;&#x6765;&#x9884;&#x9632;&#x9519;&#x8BEF;&#x3002;  </p>
<h4 id="example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><pre><code>#include &lt;event2/event.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;

/* This union&apos;s purpose is to be as big as the largest of all the
 * types it contains. */
union alignment {
    size_t sz;
    void *ptr;
    double dbl;
};
/* We need to make sure that everything we return is on the right
   alignment to hold anything, including a double. */
#define ALIGNMENT sizeof(union alignment)

/* We need to do this cast-to-char* trick on our pointers to adjust
   them; doing arithmetic on a void* is not standard. */
#define OUTPTR(ptr) (((char*)ptr)+ALIGNMENT)
#define INPTR(ptr) (((char*)ptr)-ALIGNMENT)

static size_t total_allocated = 0;
static void *replacement_malloc(size_t sz)
{
    void *chunk = malloc(sz + ALIGNMENT);
    if (!chunk) return chunk;
    total_allocated += sz;
    *(size_t*)chunk = sz;
    return OUTPTR(chunk);
}
static void *replacement_realloc(void *ptr, size_t sz)
{
    size_t old_size = 0;
    if (ptr) {
        ptr = INPTR(ptr);
        old_size = *(size_t*)ptr;
    }
    ptr = realloc(ptr, sz + ALIGNMENT);
    if (!ptr)
        return NULL;
    *(size_t*)ptr = sz;
    total_allocated = total_allocated - old_size + sz;
    return OUTPTR(ptr);
}
static void replacement_free(void *ptr)
{
    ptr = INPTR(ptr);
    total_allocated -= *(size_t*)ptr;
    free(ptr);
}
void start_counting_bytes(void)
{
    event_set_mem_functions(replacement_malloc,
                            replacement_realloc,
                            replacement_free);
}
</code></pre><p><strong> &#x6CE8;&#x610F; </strong>  </p>
<ol>
<li>&#x66FF;&#x6362;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x5F71;&#x54CD;&#x5230;Libevent&#x540E;&#x7EED;&#x8C03;&#x7528;allocate&#xFF0C;resize&#x6216;free&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5728;&#x8C03;&#x7528;&#x5176;&#x4ED6;Libevent&#x51FD;&#x6570;&#x524D;&#x8BBE;&#x7F6E;&#x5E76;&#x66FF;&#x6362;&#x4F60;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x3002; &#x5426;&#x5219;Libevent&#x5C06;&#x4F1A;&#x4F7F;&#x7528;&#x4F60;&#x7684;free&#x51FD;&#x6570;&#x53BB;&#x91CA;&#x653E;&#x90A3;&#x4E9B;&#x4F7F;&#x7528;C&#x5E93;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x83B7;&#x5F97;&#x7684;&#x5185;&#x5B58;</li>
<li>&#x4F60;&#x7684;malloc&#x548C;realloc&#x51FD;&#x6570;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x8DDF;C&#x5E93;&#x4E00;&#x6837;&#x5BF9;&#x9F50;&#x957F;&#x5EA6;(alignment)&#x7684;&#x5185;&#x5B58;&#x5757;</li>
<li>&#x4F60;&#x7684;realloc&#x51FD;&#x6570;&#x8981;&#x80FD;&#x6B63;&#x786E;&#x5904;&#x7406;<code>realloc(NULL, sz)</code>&#xFF0C; &#x76F8;&#x5F53;&#x4E8E;<code>malloc(sz)</code></li>
<li>&#x4F60;&#x7684;relloc&#x51FD;&#x6570;&#x8981;&#x80FD;&#x6B63;&#x786E;&#x5904;&#x7406;<code>realloc(ptr, 0)</code>&#xFF0C; &#x76F8;&#x5F53;&#x4E8E;<code>free(ptr)</code></li>
<li>&#x4F60;&#x7684;free&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x5904;&#x7406;<code>free(NUUL)</code></li>
<li>&#x4F60;&#x7684;malloc&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x5904;&#x7406;<code>malloc(0)</code></li>
<li>&#x4F60;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x9700;&#x8981;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</li>
<li>Libevnet&#x4F7F;&#x7528;&#x4ECE;&#x4F60;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x7533;&#x8BF7;&#x5230;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x5047;&#x82E5;Libevent&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x56DE;&#x6765;&#xFF0C;&#x800C;&#x4E14;&#x4F60;&#x4E5F;&#x66FF;&#x6362;&#x4E86;&#x4F60;&#x7684;free&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4F60;&#x9700;&#x8981;&#x8D1F;&#x8D23;&#x8C03;&#x7528;&#x4F60;&#x7684;free&#x51FD;&#x6570;&#x6765;&#x91CA;&#x653E;&#x8FD9;&#x5757;&#x5185;&#x5B58;</li>
</ol>
<p>&#x8FD9;&#x4E2A;<code>event_set_mem_functions()</code>&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x5728;&#x5934;&#x6587;&#x4EF6;<code>&lt;event2/event.h&gt;</code>&#x4E2D;&#xFF0C;&#x9996;&#x6B21;&#x51FA;&#x73B0;&#x5728;Libevent 2.0.1-alpha&#x3002;  </p>
<p>Libevent&#x53EF;&#x80FD;&#x5173;&#x95ED;&#x4E86;<code>event_set_mem_functions()</code>&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x90A3;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x5C06;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x548C;&#x94FE;&#x63A5;&#x3002; &#x5728;Libevent 2.0.2-alpha&#x4E4B;&#x540E;&#xFF0C; &#x4F60;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x5B8F;<code>EVENT_SET_MEM_FUNCTIONS_IMPLEMENTED</code>&#x662F;&#x5426;&#x5B9A;&#x4E49;&#x6765;&#x68C0;&#x67E5;Libevent&#x662F;&#x5426;&#x652F;&#x6301;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;  </p>
<p><br></p>
<h2 id="locks-and-threading-&#x9501;&#x548C;&#x7EBF;&#x7A0B;"><a href="#Locks-and-threading-&#x9501;&#x548C;&#x7EBF;&#x7A0B;" class="headerlink" title="Locks and threading &#x9501;&#x548C;&#x7EBF;&#x7A0B;"></a>Locks and threading &#x9501;&#x548C;&#x7EBF;&#x7A0B;</h2><p>&#x5982;&#x4F60;&#x6240;&#x77E5;&#xFF0C;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x540C;&#x65F6;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x5B89;&#x5168;&#x7684;&#x3002; Libevent&#x80FD;&#x4EE5;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;  </p>
<ol>
<li>&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x53EA;&#x5728;&#x5355;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#xFF1A;&#x5728;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4EFD;&#x6570;&#x636E;&#x4ECE;&#x6765;&#x4E0D;&#x662F;&#x5B89;&#x5168;&#x7684;</li>
<li>&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x9009;&#x62E9;&#x6027;&#x52A0;&#x9501;&#xFF1A;&#x4F60;&#x53EF;&#x4EE5;&#x544A;&#x8BC9;Libevent&#x67D0;&#x4E2A;&#x6570;&#x636E;&#x662F;&#x5426;&#x540C;&#x65F6;&#x7528;&#x4E8E;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;</li>
<li>&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E00;&#x76F4;&#x52A0;&#x9501;&#xFF1A;&#x5982;&#x679C;Libevent&#x80FD;&#x591F;&#x52A0;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x540C;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x662F;&#x5B89;&#x5168;&#x7684;</li>
</ol>
<p>&#x4F60;&#x9700;&#x8981;&#x544A;&#x8BC9;Libevent&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x51FD;&#x6570;&#x6765;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#xFF0C;&#x4E14;&#x9700;&#x8981;&#x5728;&#x7533;&#x8BF7;&#x4EFB;&#x4F55;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x505A;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x3002;  </p>
<p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;pthread&#x5E93;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;Windowns threading&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x5B8F;&#x6765;&#x544A;&#x8BC9;Libevent&#x6765;&#x4F7F;&#x7528;pthreads&#x6216;Windows&#x51FD;&#x6570;&#x3002;  </p>
<pre><code>#ifdef WIN32
int evthread_use_windows_threads(void);
#define EVTHREAD_USE_WINDOWS_THREADS_IMPLEMENTED
#endif
#ifdef _EVENT_HAVE_PTHREADS
int evthread_use_pthreads(void);
#define EVTHREAD_USE_PTHREADS_IMPLEMENTED
#endif
</code></pre><p>2&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;0&#x8868;&#x793A;&#x6210;&#x529F;&#xFF0C;&#x8FD4;&#x56DE;-1&#x8868;&#x793A;&#x5931;&#x8D25;&#x3002;<br>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x5E93;&#xFF0C;&#x90A3;&#x5728;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x505A;&#x591A;&#x4E00;&#x4E9B;&#x5DE5;&#x4F5C;&#x3002;&#x4F60;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4F60;&#x7684;&#x7EBF;&#x7A0B;&#x5E93;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#xFF1A;  </p>
<ul>
<li>Locks</li>
<li>locking</li>
<li>unlocking</li>
<li>lock allocation</li>
<li>lock destruction</li>
<li>Conditions</li>
<li>condition variable creation</li>
<li>condition variable destruction</li>
<li>waiting on a condition variable</li>
<li>signaling/broadcasting to a condition variable</li>
<li>Threads</li>
<li>thread ID detection</li>
</ul>
<p>&#x7136;&#x540E;&#x4F60;&#x8C03;&#x7528;<code>evthread_set_lock_callbacks</code>&#x548C;<code>evthread_set_id_callback</code>&#x6765;&#x544A;&#x8BC9;Libevent&#x6765;&#x4F7F;&#x7528;&#x4F60;&#x4E0A;&#x9762;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;&#x51FD;&#x6570;&#x3002;  </p>
<pre><code>#define EVTHREAD_WRITE  0x04
#define EVTHREAD_READ   0x08
#define EVTHREAD_TRY    0x10

#define EVTHREAD_LOCKTYPE_RECURSIVE 1
#define EVTHREAD_LOCKTYPE_READWRITE 2

#define EVTHREAD_LOCK_API_VERSION 1

struct evthread_lock_callbacks {
       int lock_api_version;
       unsigned supported_locktypes;
       void *(*alloc)(unsigned locktype);
       void (*free)(void *lock, unsigned locktype);
       int (*lock)(unsigned mode, void *lock);
       int (*unlock)(unsigned mode, void *lock);
};

int evthread_set_lock_callbacks(const struct evthread_lock_callbacks *);

void evthread_set_id_callback(unsigned long (*id_fn)(void));

struct evthread_condition_callbacks {
        int condition_api_version;
        void *(*alloc_condition)(unsigned condtype);
        void (*free_condition)(void *cond);
        int (*signal_condition)(void *cond, int broadcast);
        int (*wait_condition)(void *cond, void *lock,
            const struct timeval *timeout);
};

int evthread_set_condition_callbacks(
        const struct evthread_condition_callbacks *);
</code></pre><p>&#x6570;&#x636E;&#x7ED3;&#x6784;<code>evthread_lock_callbacks</code>&#x63CF;&#x8FF0;&#x4E86;&#x4F60;&#x7684;&#x52A0;&#x9501;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4EE5;&#x53CA;&#x4ED6;&#x4EEC;&#x7684;&#x529F;&#x80FD;&#xFF0C; &#x5404;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;  </p>
<ol>
<li>lock_api_version&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;<code>EVTHREAD_LOCK_API_VERSION</code>  </li>
<li><strong>supported_locktypes</strong>&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;<code>EVTHREAD_LOCKTYPE_*</code>&#x7684;&#x4E00;&#x4E2A;&#x4F4D;&#x63A9;&#x7801;&#xFF0C; &#x8868;&#x793A;&#x4F60;&#x80FD;&#x652F;&#x6301;&#x54EA;&#x79CD;&#x9501;&#x3002;&#xFF08;&#x5728;2.0.4-alpha&#xFF0C;&#x5F3A;&#x5236;&#x4F7F;&#x7528;<code>EVTHREAD_LOCK_RECURSIVE</code>&#x800C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;<code>EVTHREAD_LOCK_READWRITE</code>)</li>
<li>alloc&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x9501;</li>
<li>free&#x91CA;&#x653E;&#x8BE5;&#x9501;&#x6301;&#x6709;&#x7684;&#x8D44;&#x6E90;</li>
<li>lock&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x7684;&#x9501;&#xFF0C;&#x6210;&#x529F;&#x8FD4;&#x56DE;0&#xFF0C;&#x975E;0&#x8868;&#x793A;&#x5931;&#x8D25;</li>
<li>unlock&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x5C1D;&#x8BD5;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x6210;&#x529F;&#x8FD4;&#x56DE;0&#xFF0C;&#x975E;0&#x8868;&#x793A;&#x5931;&#x8D25;</li>
</ol>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x9501;&#x7684;&#x7C7B;&#x578B;&#x6709;&#xFF1A; </p>
<ol>
<li><code>0</code>: &#x666E;&#x901A;&#x7684;&#x3001;&#x975E;&#x5FC5;&#x8981;&#x7684;&#x9012;&#x5F52;&#x9501;</li>
<li><code>EVTHREAD_LOCKTYPE_RECURSIVE</code>: &#x9012;&#x5F52;&#x9501;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x83B7;&#x5F97;&#x540C;&#x4E2A;&#x9501;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x52A0;&#x9501;&#x591A;&#x5C11;&#x6B21;&#xFF0C;&#x5219;&#x89E3;&#x9501;&#x540C;&#x7B49;&#x6B21;&#x6570;&#x4E4B;&#x540E;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#x8FD9;&#x4E2A;&#x9501;</li>
<li><code>EVTHREAD_LOCKTYPE_READWRITE</code>: &#x8BFB;&#x5199;&#x9501;&#xFF0C;&#x8BFB;&#x9501;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x83B7;&#x53D6;&#xFF0C;&#x4F46;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x5185;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x80FD;&#x83B7;&#x53D6;&#x5199;&#x9501;</li>
</ol>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x52A0;&#x9501;&#x6A21;&#x5F0F;&#x6709;&#xFF1A;  </p>
<ol>
<li><code>EVTHREAD_READ</code>: &#x53EA;&#x9650;<code>READWRITE</code>, &#x83B7;&#x53D6;&#x6216;&#x91CA;&#x653E;&#x8BE5;&#x9501;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;</li>
<li><code>EVTHREAD_WRITE</code>: &#x53EA;&#x9650;<code>READWRITE</code>, &#x83B7;&#x53D6;&#x6216;&#x91CA;&#x653E;&#x8BE5;&#x9501;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;</li>
<li><code>EVTHREAD_TRY</code>: &#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x975E;&#x963B;&#x585E;&#xFF0C;&#x5728;&#x5C1D;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x5982;&#x679C;&#x80FD;&#x7ACB;&#x523B;&#x83B7;&#x5F97;&#x9501;&#x5219;&#x83B7;&#x53D6;&#x8BE5;&#x9501;</li>
</ol>
<p>&#x51FD;&#x6570;<code>evthread_set_id_callback</code>&#x7684;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;id_fn&#xFF0C;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;unsigned long&#x503C;&#x6765;&#x6807;&#x793A;&#x662F;&#x54EA;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4E14;&#x540C;&#x4E2A;&#x7EBF;&#x7A0B;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x76F8;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x4E3A;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x8FD0;&#x884C;&#x7740;2&#x4E2A;&#x7EBF;&#x7A0B;&#x8FD4;&#x56DE;&#x540C;&#x6837;&#x7684;&#x503C;&#x3002;  </p>
<p>&#x6570;&#x636E;&#x7ED3;&#x6784;<code>evthread_condition_callbacks</code>&#x8868;&#x793A;&#x6761;&#x4EF6;&#x9501;&#x3002;&#x5404;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;  </p>
<ol>
<li>lock_api_version&#x76F8;&#x5BF9;&#x4E8E;&#x4E0A;&#x9762;&#xFF0C;&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;<code>EVTHREAD_CONDITION_API_VERSION</code></li>
<li>alloc_condition&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x6761;&#x4EF6;&#x9501;&#xFF0C;&#x5165;&#x53C2;&#x662F;<code>0</code></li>
<li>free_condition&#x91CA;&#x653E;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x9501;&#x6301;&#x6709;&#x7684;&#x8D44;&#x6E90;</li>
<li>wait_condition&#x9700;&#x8981;3&#x4E2A;&#x5165;&#x53C2;&#xFF1A;<br> a) alloc_condition&#x521B;&#x5EFA;&#x7684;&#x6761;&#x4EF6;&#x9501;<br> b) evthread_lock_callbacks.alloc&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x7684;&#x9501;<br> c) &#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;<br> &#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x540E;&#x5C31;&#x80FD;&#x6301;&#x6709;&#x6761;&#x4EF6;&#x9501;&#xFF0C;&#x4E5F;&#x5FC5;&#x987B;&#x91CA;&#x653E;&#x8BE5;&#x9501;&#x3002;&#x8BE5;&#x51FD;&#x6570;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#xFF0C;&#x76F4;&#x5230;&#x6761;&#x4EF6;&#x6EE1;&#x8DB3;&#x53D1;&#x8D77;&#x4FE1;&#x53F7;&#xFF0C;&#x6216;&#x8005;&#x76F4;&#x5230;&#x8D85;&#x65F6;&#xFF1B;&#x8FD4;&#x56DE;-1&#x8868;&#x793A;&#x51FA;&#x9519;&#xFF0C;0&#x8868;&#x793A;&#x6761;&#x4EF6;&#x53D1;&#x751F;&#x4E86;&#xFF0C;1&#x8868;&#x793A;&#x8D85;&#x65F6;&#x3002;&#x8FD4;&#x56DE;&#x524D;&#x5B83;&#x8981;&#x518D;&#x786E;&#x4FDD;&#x5B83;&#x6301;&#x6709;&#x8BE5;&#x9501;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8981;&#x5524;&#x9192;&#x7B49;&#x5F85;&#x6761;&#x4EF6;&#x53D1;&#x9001;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x5E7F;&#x64AD;&#xFF0C;&#x5219;&#x8981;&#x5524;&#x9192;&#x5F53;&#x524D;&#x6240;&#x6709;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#x3002;  </li>
</ol>
<p>&#x66F4;&#x591A;&#x5173;&#x4E8E;&#x6761;&#x4EF6;&#x9501;&#xFF0C;&#x53C2;&#x8003;pthread&#x7684;<code>pthread_cond_*</code>&#x51FD;&#x6570;&#xFF0C;&#x6216;&#x8005;Windows&#x7684;<code>CONDITION_VARIABLE</code>&#x51FD;&#x6570;&#x3002;  </p>
<h4 id="examples"><a href="#Examples-1" class="headerlink" title="Examples"></a>Examples</h4><pre><code>For an example of how to use these functions, see evthread_pthread.c and
evthread_win32.c in the Libevent source distribution.
</code></pre><p>&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x5728;&#x5934;&#x6587;&#x4EF6;<code>&lt;event2/thread.h&gt;</code>&#xFF0C;&#x5927;&#x591A;&#x6570;&#x9996;&#x6B21;&#x51FA;&#x73B0;&#x5728;Libevent 2.0.4-alpha&#x3002;&#x4ECE;2.0.1-alpha&#x5230;2.0.3-alpha&#xFF0C;Libevent&#x4F7F;&#x7528;&#x65E7;&#x63A5;&#x53E3;&#x6765;&#x8BBE;&#x7F6E;&#x52A0;&#x9501;&#x51FD;&#x6570;&#x3002; &#x51FD;&#x6570;<code>event_use_pthreads()</code>&#x8981;&#x6C42;&#x4F60;&#x94FE;&#x63A5;<code>event_pthreads</code>&#x8FD9;&#x4E2A;&#x5E93;&#x6587;&#x4EF6;&#x3002;  </p>
<p>&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x7684;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x662F;&#x5728;2.0.7-rc&#x624D;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#xFF0C; &#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E00;&#x4E9B;&#x68D8;&#x624B;&#x7684;&#x6B7B;&#x9501;&#x95EE;&#x9898;&#x3002;  </p>
<p>Libevent&#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x4E0D;&#x652F;&#x6301;&#x52A0;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x90A3;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x4E5F;&#x662F;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x7684;&#x3002;  </p>
<p><br></p>
<h2 id="debugging-lock-usage-&#x8C03;&#x8BD5;&#x9501;"><a href="#Debugging-lock-usage-&#x8C03;&#x8BD5;&#x9501;" class="headerlink" title="Debugging lock usage &#x8C03;&#x8BD5;&#x9501;"></a>Debugging lock usage &#x8C03;&#x8BD5;&#x9501;</h2><p>Libevent&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;lock debugging&#x529F;&#x80FD;&#xFF0C;&#x5C01;&#x88C5;&#x4E86;&#x4F7F;&#x7528;&#x9501;&#x7684;&#x51FD;&#x6570;&#x6765;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x9519;&#x8BEF;&#x5305;&#x62EC;&#xFF1A;  </p>
<ol>
<li>&#x91CA;&#x653E;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x83B7;&#x5F97;&#x7684;&#x9501;</li>
<li>&#x91CD;&#x590D;&#x52A0;&#x9501;&#xFF0C;&#x5F53;&#x8BE5;&#x9501;&#x4E0D;&#x662F;&#x9012;&#x5F52;&#x9501;</li>
</ol>
<p>&#x5982;&#x679C;&#x4E0A;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#xFF0C;Libevent&#x4F1A;&#x56E0;&#x65AD;&#x8A00;&#x5931;&#x8D25;&#x800C;&#x9000;&#x51FA;&#x3002;  </p>
<pre><code>void evthread_enable_lock_debugging(void);
#define evthread_enable_lock_debuging() evthread_enable_lock_debugging()
</code></pre><p><strong>&#x6CE8;&#x610F;</strong><br>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x5728;&#x521B;&#x5EFA;&#x4EFB;&#x4F55;&#x9501;&#x4E4B;&#x524D;&#x5148;&#x8C03;&#x7528;&#x3002;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#xFF0C;&#x5F53;&#x4F60;&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x51FD;&#x6570;&#x4E4B;&#x540E;&#x9A6C;&#x4E0A;&#x8C03;&#x7528;&#x5B83;&#x3002;  </p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5728;2.0.4-alpha&#x4E2D;&#x521B;&#x5EFA;&#x3002;  </p>
<p><br></p>
<h2 id="&#x8C03;&#x8BD5;event"><a href="#&#x8C03;&#x8BD5;event" class="headerlink" title="&#x8C03;&#x8BD5;event"></a>&#x8C03;&#x8BD5;event</h2><p>&#x6709;&#x4E00;&#x4E9B;&#x666E;&#x901A;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x4EE5;&#x88AB;&#x76D1;&#x6D4B;&#x5E76;&#x5411;&#x4F60;&#x62A5;&#x544A;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;  </p>
<ol>
<li>&#x4F7F;&#x7528;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;event&#x6570;&#x636E;&#x7ED3;&#x6784;</li>
<li>&#x5C1D;&#x8BD5;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x672A;&#x51B3;&#x7684;event&#x6570;&#x636E;&#x7ED3;&#x6784;  </li>
</ol>
<p>&#x8DDF;&#x8E2A;&#x54EA;&#x4E9B;event&#x6CA1;&#x6709;&#x521D;&#x59CB;&#x5316;&#x9700;&#x8981;&#x6D88;&#x8017;&#x989D;&#x5916;&#x7684;cpu&#x548C;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4F60;&#x8C03;&#x8BD5;&#x7A0B;&#x5E8F;&#x65F6;&#x624D;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;  </p>
<pre><code>void event_enable_debug_mode(void);
</code></pre><p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x5728;&#x521B;&#x5EFA;&#x4EFB;&#x4F55;<code>event_base</code>&#x4E4B;&#x524D;&#x88AB;&#x5148;&#x8C03;&#x7528;&#x3002;<br>&#x4F7F;&#x7528;debug&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;<code>event_assign()</code>[&#x4E0D;&#x662F;<code>event_new()</code>]&#x6765;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7684;event&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x7528;&#x5149;&#x6240;&#x6709;&#x5185;&#x5B58;&#x3002; &#x56E0;&#x4E3A;Libevent&#x65E0;&#x6CD5;&#x5224;&#x65AD;&#x4E00;&#x4E2A;<code>event_assign()</code>&#x521B;&#x5EFA;&#x7684;event&#x662F;&#x5426;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#xFF08;&#x4F46;&#x5B83;&#x80FD;&#x8BC6;&#x522B;<code>event_new()</code>&#x521B;&#x5EFA;&#x7684;event&#x662F;&#x56E0;&#x4E3A;&#x4F60;&#x53EF;&#x4EE5;&#x8C03;&#x7528;<code>event_free()</code>&#x6765;&#x8BA9;&#x8FD9;&#x4E2A;event&#x5931;&#x6548;&#xFF09;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8017;&#x5149;&#x5185;&#x5B58;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x544A;&#x8BC9;Libevent&#x8FD9;&#x4E2A;event&#x4E0D;&#x518D;&#x8DDF;&#x8E2A;&#xFF1A;  </p>
<pre><code>void event_debug_unassign(struct event *ev);
</code></pre><p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#xFF0C;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5219;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x3002;  </p>
<h4 id="example"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><pre><code>#include &lt;event2/event.h&gt;
#include &lt;event2/event_struct.h&gt;

#include &lt;stdlib.h&gt;

void cb(evutil_socket_t fd, short what, void *ptr)
{
    /* We pass &apos;NULL&apos; as the callback pointer for the heap allocated
     * event, and we pass the event itself as the callback pointer
     * for the stack-allocated event. */
    struct event *ev = ptr;

    if (ev)
        event_debug_unassign(ev);
}

/* Here&apos;s a simple mainloop that waits until fd1 and fd2 are both
 * ready to read. */
void mainloop(evutil_socket_t fd1, evutil_socket_t fd2, int debug_mode)
{
    struct event_base *base;
    struct event event_on_stack, *event_on_heap;

    if (debug_mode)
       event_enable_debug_mode();

    base = event_base_new();

    event_on_heap = event_new(base, fd1, EV_READ, cb, NULL);
    event_assign(&amp;event_on_stack, base, fd2, EV_READ, cb, &amp;event_on_stack);

    event_add(event_on_heap, NULL);
    event_add(&amp;event_on_stack, NULL);

    event_base_dispatch(base);

    event_free(event_on_heap);
    event_base_free(base);
}
</code></pre><p><br></p>
<h2 id="&#x68C0;&#x6D4B;libevent&#x7684;&#x7248;&#x672C;"><a href="#&#x68C0;&#x6D4B;Libevent&#x7684;&#x7248;&#x672C;" class="headerlink" title="&#x68C0;&#x6D4B;Libevent&#x7684;&#x7248;&#x672C;"></a>&#x68C0;&#x6D4B;Libevent&#x7684;&#x7248;&#x672C;</h2><p>&#x65B0;&#x7248;&#x672C;&#x7684;Libevent&#x80FD;&#x5E26;&#x6765;&#x65B0;&#x7279;&#x6027;&#x548C;&#x4FEE;&#x590D;bugs&#xFF0C;&#x6709;&#x65F6;&#x4F60;&#x4F1A;&#x68C0;&#x6D4B;Libevent&#x7684;&#x7248;&#x672C;&#xFF0C;&#x4F60;&#x80FD;&#x591F;&#xFF1A;</p>
<ol>
<li>&#x68C0;&#x6D4B;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x7684;Libevent&#x7248;&#x672C;&#xFF0C;&#x6709;&#x52A9;&#x4F60;&#x521B;&#x5EFA;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;</li>
<li>&#x663E;&#x793A;Libevent&#x7248;&#x672C;&#x6765;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;</li>
<li>&#x68C0;&#x6D4B;Libevent&#x7248;&#x672C;&#x4F60;&#x80FD;&#x591F;&#x8B66;&#x544A;&#x7528;&#x6237;bugs&#xFF0C;&#x6216;&#x8005;&#x89E3;&#x51B3;bugs</li>
</ol>
<pre><code>#define LIBEVENT_VERSION_NUMBER 0x02000300
#define LIBEVENT_VERSION &quot;2.0.3-alpha&quot;
const char *event_get_version(void);
ev_uint32_t event_get_version_number(void);
</code></pre><p>&#x5B8F;&#x5B9A;&#x4E49;&#x7684;&#x7248;&#x672C;&#x53F7;&#x53EF;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x51FD;&#x6570;&#x5219;&#x5728;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x4F7F;&#x7528;&#x3002;&#x4E0D;&#x8FC7;&#x6CE8;&#x610F;&#x5230;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x662F;&#x52A8;&#x6001;&#x94FE;&#x63A5;Libevent&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x7248;&#x672C;&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x6837;&#x3002;  </p>
<p>&#x4F60;&#x80FD;&#x591F;&#x83B7;&#x5F97;2&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF1A;a)&#x53EF;&#x4EE5;&#x5C55;&#x793A;&#x7ED9;&#x7528;&#x6237;&#x7684;&#x5B57;&#x7B26;&#x4E32; &#xFF0C; b)4&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x6570;&#x5B57;&#x3002; &#x6570;&#x5B57;&#x7248;&#x672C;&#x53F7;&#x4E2D;&#xFF0C;&#x7B2C;1&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x4E3B;&#x7248;&#x672C;&#xFF0C;&#x7B2C;2&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x5C0F;&#x7248;&#x672C;&#xFF0C;&#x7B2C;3&#x4E2A;&#x5B57;&#x8282;&#x7528;&#x4E8E;&#x4FEE;&#x590D;&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x53CA;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x8868;&#x793A;&#x53D1;&#x5E03;&#x72B6;&#x6001;(0&#x7528;&#x4E8E;&#x6B63;&#x5F0F;&#x7248;&#xFF0C;&#x975E;0&#x8868;&#x793A;&#x6B63;&#x5728;&#x5F00;&#x53D1;&#x4E2D;)&#x3002;  </p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x7248;&#x672C;&#x53F7;2.0.1-alpha&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x5B57;&#x7248;&#x672C;[02 00 01 00]&#xFF0C;&#x6216;&#x8005;0x02000100.  </p>
<h4 id="example-compile-time-checks"><a href="#Example-Compile-time-checks" class="headerlink" title="Example: Compile-time checks"></a>Example: Compile-time checks</h4><pre><code>#include &lt;event2/event.h&gt;

#if !defined(LIBEVENT_VERSION_NUMBER) || LIBEVENT_VERSION_NUMBER &lt; 0x02000100
#error &quot;This version of Libevent is not supported; Get 2.0.1-alpha or later.&quot;
#endif

int
make_sandwich(void)
{
        /* Let&apos;s suppose that Libevent 6.0.5 introduces a make-me-a
           sandwich function. */
#if LIBEVENT_VERSION_NUMBER &gt;= 0x06000500
        evutil_make_me_a_sandwich();
        return 0;
#else
        return -1;
#endif
}
</code></pre><h4 id="example-run-time-checks"><a href="#Example-Run-time-checks" class="headerlink" title="Example: Run-time checks"></a>Example: Run-time checks</h4><pre><code>#include &lt;event2/event.h&gt;
#include &lt;string.h&gt;

int
check_for_old_version(void)
{
    const char *v = event_get_version();
    /* This is a dumb way to do it, but it is the only thing that works
       before Libevent 2.0. */
    if (!strncmp(v, &quot;0.&quot;, 2) ||
        !strncmp(v, &quot;1.1&quot;, 3) ||
        !strncmp(v, &quot;1.2&quot;, 3) ||
        !strncmp(v, &quot;1.3&quot;, 3)) {

        printf(&quot;Your version of Libevent is very old.  If you run into bugs,&quot;
               &quot; consider upgrading.\n&quot;);
        return -1;
    } else {
        printf(&quot;Running with Libevent version %s\n&quot;, v);
        return 0;
    }
}

int
check_version_match(void)
{
    ev_uint32_t v_compile, v_run;
    v_compile = LIBEVENT_VERSION_NUMBER;
    v_run = event_get_version_number();
    if ((v_compile &amp; 0xffff0000) != (v_run &amp; 0xffff0000)) {
        printf(&quot;Running with a Libevent version (%s) very different from the &quot;
               &quot;one we were built with (%s).\n&quot;, event_get_version(),
               LIBEVENT_VERSION);
        return -1;
    }
    return 0;
}
</code></pre><p><br></p>
<h2 id="&#x91CA;&#x653E;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;"><a href="#&#x91CA;&#x653E;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;" class="headerlink" title="&#x91CA;&#x653E;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;"></a>&#x91CA;&#x653E;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;</h2><p>&#x5373;&#x4F7F;&#x4F60;&#x91CA;&#x653E;&#x4E86;&#x6240;&#x6709;&#x4F60;&#x521B;&#x5EFA;&#x7684;Libevent&#x6570;&#x636E;&#xFF0C;&#x4ECD;&#x7136;&#x6709;&#x5C0F;&#x90E8;&#x5206;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x9057;&#x7559;&#x4E0B;&#x6765;&#x3002; &#x4E8B;&#x5B9E;&#x4E0A;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x65E6;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#xFF0C; &#x8FDB;&#x7A0B;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x4F1A;&#x88AB;&#x6E05;&#x7406;&#x56DE;&#x6536;&#x7684;&#x3002; &#x4F46;&#x9057;&#x7559;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4F1A;&#x8BA9;&#x4E00;&#x4E9B;&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x8BEF;&#x4EE5;&#x4E3A;Libevent&#x5B58;&#x5728;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8981;&#x786E;&#x4FDD;Libevent&#x91CA;&#x653E;&#x6240;&#x6709;&#x5185;&#x90E8;Libevent&#x5E93;&#x4F7F;&#x7528;&#x7684;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#xFF1A;  </p>
<pre><code>void libevent_global_shutdown(void);
</code></pre><p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5E76;&#x4E0D;&#x91CA;&#x653E;&#x90A3;&#x4E9B;&#x4F60;&#x901A;&#x8FC7;Libevent&#x7533;&#x8BF7;&#x7684;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x9000;&#x51FA;&#x524D;&#x4F60;&#x8981;&#x91CA;&#x653E;&#x90A3;&#x4E9B;&#x901A;&#x8FC7;Libevent&#x7533;&#x8BF7;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x91CA;&#x653E;events, event_bases, bufferevents&#x7B49;&#x3002;<br>&#x8C03;&#x7528;<code>libevent_global_shutdown()</code>&#x4F1A;&#x8BA9;&#x5176;&#x4ED6;Libevent&#x51FD;&#x6570;&#x53D8;&#x5F97;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x4EE5;&#x662F;&#x4F60;&#x7A0B;&#x5E8F;&#x91CC;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x7684;Libevent&#x51FD;&#x6570;&#x3002;</p>
<p><br><br>&#x2013; EOF &#x2013;</p>

	

	<div>
	    <div>Categories: <a class="category-link" href="/categories/in-lib/">in_lib</a> </div>
	    <div>Tags: <a class="tag-link" href="/tags/libevent/">libevent</a> </div>
	</div>
    </div>

    <hr />
    <footer class="article-footer">
      
        <a href="http://popozhu.github.io/2013/06/10/libevent_r1_全局参数/#disqus_thread" class="article-comment-link"></a>
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/06/11/libevent_r2_创建event_base/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-caption">&laquo;</span>
      <span class="article-nav-title">
        
          Libevent创建event_base
        
      </span>
    </a>
  
  
    <a href="/2013/06/10/libevent_r0_引言/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Libevent引言</span>
      <span class="article-nav-caption">&raquo;</span>
    </a>
  
</nav>


  
</article>


<section id="comments">
  <div id="disqus_thread"> </div>
</section>


</section>

	    <footer id="footer">
    popozhu &copy; 2016 
</footer>

	</div>

	
<!--
<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
-->


<script>
  var disqus_shortname = 'popozhu';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


<script src="/js/script.js"></script>


    </body>
</html>
