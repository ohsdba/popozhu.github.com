<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    

    <title>hexo的代码高亮 | popozhu</title>

    

    <!-- css -->
    <link href="http://fonts.useso.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    </head>

    <body>
	<div class="container">
	    <div class="banner">
    <div>
        <span class="site-title"> <a href="/" id="logo">popozhu</a> </span>

        
    </div>

    <div class="banner-right">
        <span class="banner-item"> <a href="/archives"> Misc </a> </span>
        <span class="banner-item"> <a href="/about"> About </a> </span>
    </div>
</div>


	    <section id="main"><article class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
	<header class="article-header">
	    <div class="article-title">
		<div class="title">hexo的代码高亮</div> 
		<small>
		    <time datetime="2013-06-14T17:14:20.000Z" itemprop="datePublished">June 15 2013</time>
		</small>
	    </div>
	</header>
    

    <div class="article-entry" itemprop="articleBody">
	
	    
	    

	    <p>前2个星期使用hexo的<a href="http://zespia.tw/hexo/zh-CN/docs/tag-plugins.html" target="_blank" rel="external">标签插件</a>，在写文章内容，对于代码我都使用其中的<code>Code Block</code>来高亮显示。<br>Code Block在markdown中使用可以参考<a href="http://octopress.org/docs/plugins/codeblock/" target="_blank" rel="external">这里</a>，语法为：  </p>

```
{% codeblock [title] [lang:language] [url] [link text] %}
code snippet
{% endcodeblock %}
```

<p>最初我并没有在codeblock中指定<code>[lang:language]</code>：<br>
```
{% codeblock %}
  my code here...
  my code continue...
  my code end...
{% endcodeblock %}
```
</p>
<p>于是代码高亮有时候不能正确显示，比如对于c的注释<code>/* some comment */</code>，单纯一行的注释是没问题的，但如果遇到多行的注释，则在注释开始<code>/*</code>之后的内容，甚至包括注释结尾<code>*/</code>之后的代码，就不能正常高亮显示，这困扰了我一个多星期。  </p>
<p>今晚看了下hexo的<a href="https://github.com/tommy351/hexo/blob/master/lib/util/highlight.js" target="_blank" rel="external">highlight.js</a>这个js内容，它对代码高亮的语言类型做了点预处理和判断：在调用真实做代码高亮的脚本<a href="https://github.com/isagalaev/highlight.js" target="_blank" rel="external">in github</a>前，先判断codeblock是否带lang这个key，如果没有，就让highlight自动高亮代码，问题是这个<strong>自动</strong>不够智能。  </p>
<p>于是手动在codeblock中增加<code>[lang:language]</code>来显式指定代码语言，问题是一开始我使用的是<code>lang:c++</code>，然而识别不到c++，代码高亮还是不正常，让我很迷惑。难道真的是highlight.js对于token的解析有错误吗？  </p>
<p>后来，在highlight-&gt;github-&gt;readme中看到，如果要自定义高亮方案，说是参考文件<a href="https://github.com/isagalaev/highlight.js/blob/master/classref.txt" target="_blank" rel="external">classref.txt</a>，上面包含了它支持的语言的类型，其中：  </p>
<pre><code>C++ (&quot;cpp&quot;):
  keyword keyword
  number number
  string string and character
  comment comment
  preprocessor preprocessor directive
  stl_container instantiation of STL containers (&quot;vector&lt;...&gt;&quot;)
</code></pre><p><hr><br>sigh…在codeblock中应该添加<code>lang:cpp</code>来指明要高亮的语言，而不是<code>lang:c++</code>，其他语言也类似参考这份定义。  </p>
<p>于是正常高亮代码。<br>
```
{% codeblock lang:cpp %}
  my code here...  
  my code continue...
  my code end...
{% endcodeblock %}
```
</p>
<p>hexo的<a href="https://github.com/tommy351/hexo/blob/master/lib/util/highlight.js" target="_blank" rel="external">highlight.js</a>增加了<code>lang:plain</code>这个类型的支持：</p>
<pre><code>  if (!options.lang){
    var compiled = hljs.highlightAuto(raw).value;
  } else if (options.lang === &#39;plain&#39;){
    var compiled = raw;
  } else {
    var lang = options.lang.toLowerCase();

    if (keys.indexOf(lang) !== -1) lang = alias[lang];

    try {
      var compiled = hljs.highlight(lang, raw).value;
    } catch (e){
      var compiled = hljs.highlightAuto(raw).value;
    }
  }
</code></pre><p>可以用这个类型来屏蔽一些代码高亮，比如写一些伪代码时就可以用上了。   </p>
<p>根据<a href="https://github.com/isagalaev/highlight.js/tree/master/src/styles" target="_blank" rel="external">styles</a>使用了几个高亮颜色方案，最后还是恢复hexo默认主题自带的颜色。  </p>
<p><br><br>– EOF –</p>

	

	<div>
	    <div>Categories: <a class="category-link" href="/categories/hexo/">hexo</a> </div>
	    <div>Tags:<a class="tag-link" href="/tags/hexo/">hexo</a> </div>
	</div>
    </div>

    <hr />
    <footer class="article-footer">
      
        <a href="http://popozhu.github.io/2013/06/15/hexo代码高亮/#disqus_thread" class="article-comment-link"></a>
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/06/15/libevent_r4_事件/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-caption">&laquo;</span>
      <span class="article-nav-title">
        
          Libevent事件
        
      </span>
    </a>
  
  
    <a href="/2013/06/12/libevent_r3_事件轮询/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Libevent事件轮询</span>
      <span class="article-nav-caption">&raquo;</span>
    </a>
  
</nav>


  
</article>


<section id="comments">
  <div id="disqus_thread"> </div>
</section>


</section>

	    <footer id="footer">
    popozhu &copy; 2016 
</footer>

	</div>

	
<!--
<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
-->


<script>
  var disqus_shortname = 'popozhu';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


<script src="/js/script.js" type="text/javascript"></script>


    </body>
</html>
