<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    

    <title>OS X 自带的词典 | popozhu</title>

    


    </head>

    <body>
	<div class="container">
	    <div class="banner">
    <div>
        <span class="site-title"> <a href="/" id="logo">popozhu</a> </span>

        
    </div>

    <div class="banner-right">
        <span class="banner-item"> <a href="/archives"> Misc </a> </span>
        <span class="banner-item"> <a href="/about"> About </a> </span>
    </div>
</div>


	    <section id="main"><article class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
	<header class="article-header">
	    <div class="article-title">
		<div class="title">OS X 自带的词典</div> 
		<small>
		    <time datetime="2014-08-09T14:20:53.000Z" itemprop="datePublished">August 9 2014</time>
		</small>
	    </div>
	</header>
    

    <div class="article-entry" itemprop="articleBody">
	
	    
	    

	    <p>2014-10-27 更新：</p>
<p>Firefox 34 已经支持系统的「查找」翻译单词了，赞。</p>
<p>so，以下内容愉快地废弃 :D</p>
<hr>

<p>OS X 平台上，用过「有道词典」以及系统自带的「词典」。 前者功能更多一些，但启动速度则不如后者。 启动之后，系统的「词典」能自动把光标定位到「输入栏」里，可马上输入单词，使用场景对比： </p>
<ol>
<li>启动「有道词典」，把鼠标移动到「输入栏」，点击一下，开始输入单词，回车获取结果</li>
<li>启动系统「词典」，直接输入单词，回车获取结果</li>
</ol>
<p>除了玩游戏，平时只使用触摸板，第二种更适合我。</p>
<p>在上面的查询后，「重新」查询另一个单词，则：</p>
<ol>
<li>把鼠标移动到「有道词典」的「输入栏」，点击一下，删除当前已有的单词，开始输入新的单词，回车获取结果</li>
<li><code>⌘+w</code>关闭系统「词典」，重新打开，可立即开始输入新单词，回车获取结果。因为它的启动速度够快（两个软件都有启动的快捷键）但「有道词典」就不适合频繁重启，启动慢等待时间久</li>
</ol>
<p>在原生Cocoa的软件内，开启了手势后可直接通过「三个手指」轻按一个单词来进行查找/翻译（系统偏好设置 - 触控板 - 光标与点按 - 查找）也可以先选择一个单词，快捷键<code>⌃+⌘+d</code>启动「查找」。 英语水平一般的我在阅读时经常使用这个小功能，非常方便。</p>
<p>但firefox不支持这个功能，曾经一度在阅读英文页面前，先把页面转到safari上打开了再看。</p>
<p>有一个firefox扩展<code>Mac OS X Dictionary Add-On 1.1.1</code>，算是曲线救国。 安装后，对一个单词右键一下，在「右键菜单」里有一个选项：<code>Look Up xxx in Dictionary</code>，通过它实现了在firefox里打开系统「词典」搜索该单词。但没有快捷键，想象一下两个场景：</p>
<ol>
<li>把鼠标移动到某个单词，右键，选择Look up，系统「词典」自动开启，显示该单词查找/翻译结果。在「右键菜单」点击Look up的操作，有一个眼睛视线查找过程，感觉很不方便。我很少使用「右键菜单」</li>
<li>把鼠标移动到某个单词，双击该单词（此时选中它了），按一个快捷键，系统「词典」自动开启，显示结果</li>
</ol>
<p>现在可以实现第二种操作了，直接使用了扩展<code>Mac OS X Dictionary</code>的部分js代码，实现两个功能：</p>
<ol>
<li>获取当前页面「选中」的单词</li>
<li>打开系统「词典」查询该单词</li>
</ol>
<p>另外需要为该功能添加一个快捷键，通过另一个firefox扩展<code>keyconfig</code>，为上面的功能分配一个快捷键<code>⌂+⌘+d</code>，该快捷键不能跟系统/firefox已有的冲突。</p>
<p><hr><br>第一步，在firefox地址栏里输入<code>about:support</code>打开support页面，在<code>Application Basics - Profile Folder</code>项目里，有一个<code>Show in Finder</code>的按钮，通过它打开firefox当前的配置文件夹。在extensions目录下可找到已安装的macosxdictionary扩展，复制到其他地方。</p>
<pre><code>.
└── uldw6wyn.default
   ├── extensions
   │   ├── macosxdictionary@micheldalal.com.xpi
</code></pre><p>把<code>macosxdictionary@micheldalal.com.xpi</code>的xpi后缀修改为zip，解压，按如下路径找到<code>macosxdictionary.js</code>，它里面包含了实现第一步的js代码，我直接拿来使用了。</p>
<pre><code>macosxdictionary@micheldalal.com
├── defaults
│   └── preferences
│       └── macosxdictionary.js
</code></pre><p>提取的js代码如下，在下一步的<code>keyconfig</code>中将会使用到它。</p>
<pre><code>function getSelectedText()
{
    var node, focusedWindow;
    var selection;

    selection = &quot;&quot;;
    node = document.popupNode;
    if ( ( node instanceof HTMLTextAreaElement ) || ( node instanceof HTMLInputElement &amp;&amp; node.nodeType == Node.TEXT_NODE ) )
    {
        selection = node.value.substring( node.selectionStart, node.selectionEnd );
    }
    else
    {
        focusedWindow = new XPCNativeWrapper( document.commandDispatcher.focusedWindow, &#39;document&#39;, &#39;getSelection()&#39; );
        selection = focusedWindow.getSelection().toString();
    }

    selection = selection.replace(/(\n|\r|\t|(\r\n))+/g, &quot; &quot;);

    // Trim the value(remove the space at the beginning and the end)
    selection = selection.replace(/(^\s+)|(\s+$)/g, &quot;&quot;);
    selection = selection.split(&quot; &quot;);
    selection = selection.join(&quot; &quot;);

    return selection;
}

var selectedText = getSelectedText();

// Open the dictionary application

// create an nsILocalFile for the executable
var file = Components.classes[ &quot;@mozilla.org/file/local;1&quot; ].createInstance( Components.interfaces.nsILocalFile );
file.initWithPath( &quot;/usr/bin/open&quot; );

// create an nsIProcess
var process = Components.classes[ &quot;@mozilla.org/process/util;1&quot; ].createInstance( Components.interfaces.nsIProcess );
process.init(file);

// Run the process.
// If first param is true, calling thread will be blocked until
// called process terminates.
// Second and third params are used to pass command-line arguments
// to the process.
var args = [ &quot;dict:///&quot; + selectedText ];
process.run(false, args, args.length);
</code></pre><p>每种文件有一个默认的打开app，<code>/usr/bin/open</code>会调用默认的app来打开该文件。<code>&quot;dict:///&quot; + selectedText</code>则告诉系统「词典」要对selectedText进行翻译。</p>
<p><hr><br>安装了<code>keyconfig</code>扩展后，打开它的配置。</p>
<ol>
<li>选择<code>Add a new key</code>，弹出的输入框中，<code>Name</code>输入该快捷键的名字，比如<code>0Look up in Dictionary</code>， 名字前添加一个数字，方便查找。</li>
<li>在<code>/* CODE */</code>这里，粘贴上面的js代码，点击ok保存。</li>
<li>默认是没有快捷键，显示为<code>&lt;Disabled&gt;</code>（在<code>Apply</code>左边）输入快捷键，比如<code>⌂+⌘+d</code>，Apply保存一下</li>
</ol>
<p>回到firefox后就可以愉快地：</p>
<ol>
<li>双击选中一个单词，<code>⌂+⌘+d</code>，在弹出的「词典」中查看翻译</li>
<li><code>⌘+w</code>关闭词典</li>
</ol>
<p>伸手党万岁。。。强迫症党万岁。。。</p>
<p><hr><br>link:</p>
<ol>
<li><a href="http://micheldalal.com/sw/ff/dic/index.html" target="_blank" rel="external">Mac OS X Dictionary Add-On 1.1.1</a></li>
<li><a href="http://mozilla.dorando.at/keyconfig.xpi" target="_blank" rel="external">keyconfig</a></li>
</ol>
<p><br><br>– EOF –</p>

	

	<div>
	    <div>Categories: <a class="category-link" href="/categories/mac/">mac</a> </div>
	    <div>Tags:<a class="tag-link" href="/tags/mac/">mac</a> </div>
	</div>
    </div>

    <hr />
    <footer class="article-footer">
      
        <a href="http://popozhu.github.io/2014/08/09/os-x-自带的字典/#disqus_thread" class="article-comment-link"></a>
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/09/13/初次使用hbase/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-caption">&laquo;</span>
      <span class="article-nav-title">
        
          初次使用hbase
        
      </span>
    </a>
  
  
    <a href="/2014/07/20/kerberos-extras-for-os-x/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Kerberos Extras for OS X</span>
      <span class="article-nav-caption">&raquo;</span>
    </a>
  
</nav>


  
</article>


<section id="comments">
  <div id="disqus_thread"> </div>
</section>


</section>

	    <footer id="footer">
    popozhu &copy; 2016 
</footer>

	</div>

	
<!-- css -->
<link href="http://fonts.useso.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">

<!--
<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
-->


<script>
  var disqus_shortname = 'popozhu';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


<script src="/js/script.js" type="text/javascript"></script>


    </body>
</html>
