<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    

    <title>Kerberos Extras for OS X | popozhu</title>

    

    <link href="http://fonts.useso.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    </head>

    <body>
	<div class="container">
	    <div class="banner">
    <span class="site-title"> <a href="/" id="logo">popozhu</a> </span>

    
    <span class="site-subtitle"> do not go gentle into that good night </span>
    
</div>


	    <section id="main"><article class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
	<header class="article-header">
	    <div class="article-title">
		<div class="title">Kerberos Extras for OS X</div> 
		<small>
		    <time datetime="2014-07-20T13:29:55.000Z" itemprop="datePublished">July 20th 2014</time>
		</small>
	    </div>
	</header>
    

    <div class="article-entry" itemprop="articleBody">
	
	    
	    

	    <p>如果在mac上使用kerberos遇到了问题，可以考虑安装 <a href="http://web.mit.edu/macdev/KfM/Common/Documentation/osx-kerberos-extras.html" target="_blank" rel="external">Kerberos Extras</a>.</p>
<p>对于我，我通过<code>kinit</code>成功获取到了<code>票据</code>，但连接到服务端时仍提示让我输入密码。 使用票据的话是不需再输入密码的，那么是没使用到票据，或者票据有问题。 </p>
<p>ssh连接会使用几种验证方式(PreferredAuthentications)，通过<code>man ssh_config</code>，搜索<code>PreferredAuthentications</code>可以看到ssh使用的几种验证方式，且按顺序逐一尝试，默认是:</p>
<pre><code>gssapi-with-mic,hostbased,publickey,keyboard-interactive,password
</code></pre><p>可以在配置文件<code>/etc/ssh_config</code>中增加配置项来调整尝试的方式、顺序，或者减少验证方式。 </p>
<pre><code>PreferredAuthentications: gssapi-with-mic,hostbased,publickey,keyboard-interactive,password
</code></pre><p>从默认值可以看出，第一个尝试的方式就是查找票据。 通过<code>ssh -v</code>打开更多信息输出，可以看到报错，找不到票据，最后使用了password验证的方式，提示输入密码。问题看起来是，能获取到票据，但无法使用到该票据。 它做了两个事情: </p>
<p>在网上找到解决方法，安装<code>Kerberos Extras</code>，让kerberos支持基于CFM(Code Fragment Manager)的程序。</p>
<ol>
<li>安装<code>Kerberos CFM support library</code></li>
<li>把/System/Library/CoreSevices/票据显示程序.app链接为/Applications/Utilities/Ticket Viewer.app</li>
</ol>
<p><strong>提示</strong>: 安装时注意有一个步骤，选择「自定义」，<strong>不要</strong>安装MIT自家的配置文件<code>edu.mit.Kerberos</code>。</p>
<p>好啦，主要是步骤一，那些还在使用CFM的程序们就能够正确使用到kerberos，这时就能无密码连接了，在服务器端执行<code>klist</code>也能看到带上来的票据，票据初始化的时间，跟当前ssh连接的时间点是一致的；返回到本地再<code>klist</code>也能看到本地保存有服务器端的票据，票据交换成功。</p>
<p>CFM和动态链接dyld是Mac os x上的两种运行时环境(<a href="http://osxbook.com/book/bonus/ancient/whatismacosx/programming.html" target="_blank" rel="external">Runtime Environment</a>)，摘录如下:</p>
<pre><code>CFM determines addresses for referenced symbols in executables at build time (a static approach). The executable format used is called PEF (Preferred Executable Format). dyld resolves undefined symbols at execution time. The executable format is Mach-O (Mach object-file-format).
</code></pre><p>看起来CFM有点像静态链接，未深究。</p>
<p><hr><br>额外的话题，每次本地kinit时要输入密码，可以把密码保存到keychain中，<code>kinit username</code>时直接回车就可以了。</p>
<pre><code>security add-generic-password -a &quot;xiaojie.zhang1&quot; -l &quot;XXX.OPI.COM (your_user_name)&quot; -s &quot;xxx.OPI.COM&quot; -w “your_passwd&quot; -T &quot;/usr/bin/kinit”
</code></pre><p>具体用法，<code>man security</code>，再找到<code>add-generic-password</code>的各个参数。</p>
<pre><code>add-generic-password [-h] [-a account] [-s service] [-w password] [options...] [keychain]
    Add a generic password item.

    -a account      Specify account name (required)
    -c creator      Specify item creator (optional four-character code)
    -C type         Specify item type (optional four-character code)
    -D kind         Specify kind (default is &quot;application password&quot;)
    -G value        Specify generic attribute value (optional)
    -j comment      Specify comment string (optional)
    -l label        Specify label (if omitted, service name is used as default label)
    -s service      Specify service name (required)
    -p password     Specify password to be added (legacy option, equivalent to -w)
    -w password     Specify password to be added
    -A              Allow any application to access this item without warning (insecure, not recommended!)
    -T appPath      Specify an application which may access this item (multiple -T options are allowed)
    -U              Update item if it already exists (if omitted, the item cannot already exist)
</code></pre><p><hr><br>票据会过期，过期后重新kinit，但tmux的session不会自动加载这个新的票据。</p>
<p>to be continue…</p>
<p><br><br>– EOF –</p>

	

	<div>
	    <div>Categories: <a class="category-link" href="/categories/mac/">mac</a> </div>
	    <div>Tags:<a class="tag-link" href="/tags/kerberos/">kerberos</a>,<a class="tag-link" href="/tags/mac/">mac</a> </div>
	</div>
    </div>

    <hr />
    <footer class="article-footer">
      
        <a href="http://popozhu.github.io/2014/07/20/kerberos-extras-for-os-x/#disqus_thread" class="article-comment-link"></a>
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/08/09/os-x-自带的字典/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-caption">&laquo;</span>
      <span class="article-nav-title">
        
          OS X 自带的词典
        
      </span>
    </a>
  
  
    <a href="/2014/07/03/ueditor图片上传路径配置/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">ueditor图片上传路径配置</span>
      <span class="article-nav-caption">&raquo;</span>
    </a>
  
</nav>


  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


</section>

	    <footer id="footer">
    <span> <a href="/about"> About </a> </span>
    <span> <a href="/archives"> Misc </a> </span>

    <span>
	<a href="http://hexo.io/" title="Hexo">Hexo</a>
    </span>
    <span>
	&copy; popozhu 2015 
    </span>
</footer>

	</div>

	
<!--
<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
-->


<script>
  var disqus_shortname = 'popozhu';
  
  var disqus_url = 'http://popozhu.github.io/2014/07/20/kerberos-extras-for-os-x/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/script.js" type="text/javascript"></script>

    </body>
</html>
